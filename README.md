# 削孔検層データ統合分析システム

三井掘削レポート用のデータ分析・可視化アプリケーション

## 主な機能

- 📊 **インタラクティブな3D可視化** - Plotlyによる美しいグラフ
- 🔧 **ノイズ除去** - LOWESS法による穿孔エネルギー値のスムージング
- 📦 **VTKファイル生成** - ParaView等で表示可能な3D軌跡データ
- 📍 **測点座標管理** - 手動入力とCSVインポート対応
- 📈 **統計分析** - データ分布、相関行列の可視化

## セットアップ

### 1. 仮想環境の作成と有効化

```bash
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# または
.venv\Scripts\activate  # Windows
```

### 2. 依存関係のインストール

```bash
pip install -r requirements.txt
```

## 使用方法

### アプリケーションの起動

```bash
streamlit run app.py
```

ブラウザが自動的に開き、 `http://localhost:8501` でアプリケーションが表示されます。

### データの読み込み

1. **CSVファイルのアップロード**
   - 左サイドバーからCSVファイルを選択
   - 複数ファイルの同時読み込み対応
   - Shift-JISエンコーディング自動検出

2. **サンプルデータの使用**
   - 「サンプルデータを使用」にチェック
   - `data/`フォルダ内のCSVファイルを自動読み込み

### 主な機能タブ

#### 📊 データ概要
- データの基本統計情報
- データプレビュー（最初の100行）
- カラム情報と欠損値の確認

#### 📈 可視化
- **3D軌跡**: 削孔経路の3次元表示
- **深度-エネルギー**: 深度とエネルギー値の関係
- **エネルギー分布**: ヒストグラムと箱ひげ図
- **相関マトリックス**: パラメータ間の相関

#### 🔧 ノイズ除去
- LOWESS法によるスムージング
- パラメータ調整可能（frac, it, delta）
- 処理前後の比較表示

#### 📦 VTK生成
- 3D軌跡データのVTKファイル出力
- サンプリング間隔の調整
- エネルギー値のスカラーデータ付加
- ダウンロードボタンで保存

#### 📍 測点管理
- 手動での座標入力
- CSVファイルからの一括インポート
- 3D表示での確認
- パラメータ（ヤング率、粘着力、内部摩擦角）の管理

## データ形式

### 入力CSVファイルの形式

必須カラム:
- `TD` または `x:TD(m)`: 深度距離
- `X(m)`, `Y(m)`, `Z:標高(m)`: 3D座標（オプション）

エネルギー関連カラム:
- `穿孔エネルギー`: 全体のエネルギー値
- `Ene-L`, `Ene-M`, `Ene-R`: 左・中央・右のエネルギー値

### VTK出力形式

- PolyData形式
- ポリラインとして軌跡を表現
- エネルギー値をスカラーデータとして付加
- ParaView、VisIt等で表示可能

## プロジェクト構造

```
report_drill_mitsui/
├── app.py                    # メインアプリケーション
├── src/
│   ├── __init__.py
│   ├── data_loader.py       # データ読み込みモジュール
│   ├── noise_remover.py     # ノイズ除去モジュール
│   ├── vtk_generator.py     # VTK生成モジュール
│   └── plotly_visualizer.py # Plotlyグラフ作成モジュール
├── data/                     # サンプルデータ
│   └── script/              # 既存スクリプト（参考用）
├── requirements.txt          # Python依存関係
└── README.md                # このファイル
```

## トラブルシューティング

### エンコーディングエラー
- CSVファイルのエンコーディングは自動検出されます
- Shift-JIS、UTF-8、CP932に対応

### VTKライブラリのインストールエラー
```bash
# Linux/Macの場合
sudo apt-get install python3-vtk9  # Ubuntu/Debian
brew install vtk  # Mac

# Windowsの場合
pip install --upgrade vtk
```

### メモリ不足エラー
- サンプリング間隔を増やして データ量を削減
- 大きなファイルは分割して処理

## ライセンス

三井掘削レポート専用システム

## サポート

問題が発生した場合は、プロジェクト管理者にお問い合わせください。